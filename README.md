# 売上ダッシュボードアプリ v2.0.0

## 📊 概要

このアプリは売上データを分析するためのマルチページダッシュボードです。CSVファイルからデータを読み込み、様々な角度から売上・粗利を分析できます。さらに、AIアシスタント機能により、自然言語でデータ分析を行うことができます。

**🎉 v2.0.0の新機能:**
- パフォーマンス最適化とエラーハンドリング強化
- データ検証機能の追加
- 設定管理システムの導入
- UI/UXの改善
- データエクスポート機能
- パフォーマンス監視機能

## 🚀 機能

### 1. サマリーダッシュボード（メインページ）
- 売上金額と粗利金額の年月別グラフ
- 顧客名、商品名、担当者名でのフィルター機能
- KPI カード（総売上、総粗利、粗利率、平均売上）
- 昨対比分析
- 売上TOP10商品・担当者ランキング
- データエクスポート機能

### 2. 担当者分析ページ
- 担当者別の売上・粗利・昨対比の時系列グラフ
- その担当者の売上金額TOP20商品リスト
- その担当者の粗利金額TOP20商品リスト
- 期間指定フィルター機能

### 3. 商品分析ページ
- 商品別の売上・粗利・昨対比の時系列グラフ
- その商品の売上上位担当者TOP20リスト
- 担当者別売上比較グラフ
- 期間指定フィルター機能

### 4. AIアシスタントページ
- 自然言語での売上データ分析
- チャット形式での質問応答
- よくある質問のクイックボタン
- LLMサーバーとの連携

## 📁 ファイル構成

```
売上ダッシュボードアプリ(課題)/
├── app.py                    # メインアプリ（サマリーダッシュボード）
├── utils.py                  # 共通ユーティリティクラス
├── config.py                 # 設定管理クラス
├── pages/
│   ├── 01_担当者分析.py      # 担当者分析ページ
│   ├── 02_商品分析.py        # 商品分析ページ
│   └── 03_AIアシスタント.py  # AIアシスタントページ
├── requirements.txt          # 必要なライブラリ
├── env_example.txt           # 環境変数設定例
├── sales_test_data_utf8.csv  # 売上データ
└── README.md                 # このファイル
```

## 🛠️ セットアップ

### 1. 環境変数の設定

プロジェクトのルートに `.env` ファイルを作成し、以下の設定を追加してください：

```bash
# API設定
API_KEY=your_openai_api_key_here
LLM_URL=https://api.openai.com

# 機能設定
ENABLE_AI_FEATURES=true
ENABLE_EXPORT=true
ENABLE_VALIDATION=true

# パフォーマンス設定
MAX_RECORDS_DISPLAY=1000
```

または、`env_example.txt` を参考にして設定してください。

### 2. Streamlit Secrets設定（推奨）

AIアシスタント機能を使用する場合は、Streamlit secretsの設定も可能です：

1. プロジェクトのルートに `.streamlit` フォルダを作成
2. `.streamlit/secrets.toml` ファイルを作成
3. 以下の内容を追加：

```toml
API_KEY = "your_openai_api_key_here"
LLM_URL = "https://api.openai.com"
```

### 3. 必要なライブラリのインストール

```bash
pip install -r requirements.txt
```

### 4. LLMサーバーの起動（AI機能を使用する場合）

AIアシスタント機能を使用する場合は、LLMサーバーを起動してください：
- サーバーURL: `http://127.0.0.1:1234`
- 対応API: `/v1/chat/completions`

### 5. アプリの起動

```bash
streamlit run app.py
```

## 🔧 新機能詳細

### データ検証機能
- CSVファイルの形式チェック
- 必要な列の存在確認
- データ型の妥当性検証
- 粗利計算の整合性チェック
- 欠損値の検出

### パフォーマンス最適化
- データ読み込みのキャッシュ機能
- 効率的なフィルター処理
- メモリ使用量の監視
- 処理時間の計測

### エラーハンドリング
- データ読み込みエラーの適切な処理
- API接続エラーの処理
- ユーザーフレンドリーなエラーメッセージ
- ローディング状態の表示

### 設定管理
- 環境変数による設定
- 設定ファイルの読み込み
- 設定の妥当性検証
- テーマカスタマイズ

## 📊 データ形式

CSVファイルは以下の列を含む必要があります：

- `売上年月`: 売上の年月（YYYY-MM形式）
- `商品名`: 商品の名前
- `担当者`: 担当者の名前
- `顧客名`: 顧客の名前
- `売上金額`: 売上金額（数値）
- `仕入れ金額`: 仕入れ金額（数値）
- `粗利金額`: 粗利金額（数値）

## 🎯 使い方

### サマリーダッシュボード
1. サイドバーのフィルターで期間、担当者、商品、顧客を選択
2. KPI カードで全体の売上状況を確認
3. グラフで売上・粗利の推移と昨対比を確認
4. TOP10ランキングで主要な商品・担当者を確認
5. CSVダウンロードボタンでデータをエクスポート

### 担当者分析
1. 担当者を選択
2. 期間フィルターで分析期間を設定
3. 時系列グラフで売上・粗利の推移を確認
4. TOP20商品リストで担当者の強みを分析

### 商品分析
1. 商品を選択
2. 期間フィルターで分析期間を設定
3. 時系列グラフで売上・粗利の推移を確認
4. 担当者別売上比較で商品の販売状況を分析

### AIアシスタント
1. フィルターで分析対象を設定
2. チャット入力で自然言語で質問
3. よくある質問ボタンでクイック分析
4. AIが売上データを基に回答を生成

## 🤖 AIアシスタント機能

### 対応質問例
- 「売上トレンドを分析して」
- 「担当者別パフォーマンスを教えて」
- 「商品別分析をして」
- 「収益性分析をして」
- 「最も売上が良い商品は？」
- 「粗利率の高い商品は？」
- 「成長している担当者は？」

### LLM接続設定
- デフォルトURL: `https://api.openai.com`
- API形式: OpenAI互換
- エンドポイント: `/v1/chat/completions`

## 📈 分析機能

- **時系列分析**: 月次での売上・粗利推移
- **昨対比分析**: 前月比での成長率
- **ランキング分析**: TOP10/TOP20商品・担当者
- **フィルター機能**: 期間・担当者・商品・顧客での絞り込み
- **KPI 表示**: 重要な指標の可視化
- **AI分析**: 自然言語でのデータ分析
- **データ検証**: データ品質の確認
- **エクスポート**: CSV形式でのデータ出力

## 🔧 技術仕様

- **フレームワーク**: Streamlit 1.28.0+
- **データ処理**: Pandas 2.0.0+
- **グラフ描画**: Plotly 5.15.0+
- **数値計算**: NumPy 1.24.0+
- **AI連携**: OpenAI 1.0.0+
- **HTTP通信**: Requests 2.31.0+
- **パフォーマンス監視**: psutil 5.9.0+
- **設定管理**: python-dotenv 1.0.0+

## 🚀 デプロイ・起動方法

### ローカル環境
1. 必要なパッケージをインストール
```bash
pip install -r requirements.txt
```

2. 環境変数を設定
```bash
cp env_example.txt .env
# .envファイルを編集してAPIキーなどを設定
```

3. アプリを起動
```bash
streamlit run app.py
```

### Heroku等でのデプロイ
Procfileを利用してください。

### Docker環境
```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8501

CMD ["streamlit", "run", "app.py", "--server.port=8501", "--server.address=0.0.0.0"]
```

## 📝 注意事項

- CSVファイルはUTF-8エンコーディングで保存してください
- 日付形式は YYYY-MM 形式で入力してください
- 金額は数値形式で入力してください
- AI機能を使用する場合は、APIキーの設定が必要です
- 大量データを扱う場合は、`MAX_RECORDS_DISPLAY`の設定を調整してください

## 🔄 更新履歴

### v2.0.0 (2024-12-19)
- パフォーマンス最適化
- エラーハンドリング強化
- データ検証機能追加
- 設定管理システム導入
- UI/UX改善
- データエクスポート機能
- パフォーマンス監視機能

### v1.0.0 (初期版)
- 基本的なダッシュボード機能
- 担当者・商品分析
- AIアシスタント機能
